<!DOCTYPE html>
<html>
<head>
    <title>Metro test</title>
    <script src="http://d3js.org/d3.v2.min.js?2.9.1"></script>
    <script src="./d3.tip.min.js"></script>
    <style>
        html {
            min-width: 1040px;
        }

        .d3-tip {
            line-height: 1;
            font-weight: bold;
            padding: 12px;
            background: rgba(0, 0, 0, 0.8);
            color: #fff;
            border-radius: 2px;
        }

        .d3-tip text {
            fill: #fff;
            font-size: 12px;
            stroke: none;
            font-family: "Helvetica Neue", Helvetica, Arial, sans-serif;
        }

        body {
            position: relative;
            font-family: "Helvetica Neue", Helvetica, sans-serif;
            margin: 1em auto 4em auto;
            width: 960px;
        }

        h1 {
            font-size: 64px;
            font-weight: 300;
            letter-spacing: -2px;
            margin: .3em 0 .1em 0;
        }

        h2 {
            margin-top: 2em;
        }

        h1, h2 {
            text-rendering: optimizeLegibility;
        }

        h2 a {
            color: #ccc;
            left: -20px;
            position: absolute;
            width: 740px;
        }

        footer {
            font-size: small;
            margin-top: 8em;
        }

        header aside {
            margin-top: 82px;
        }

        header aside,
        footer aside {
            color: #636363;
            text-align: right;
        }

        aside {
            font-size: small;
            left: 780px;
            position: absolute;
            width: 180px;
        }

        .attribution {
            font-size: small;
            margin-bottom: 2em;
        }

        body > p, li > p {
            line-height: 1.5em;
        }

        body > p {
            width: 720px;
        }

        body > blockquote {
            width: 640px;
        }

        li {
            width: 680px;
        }

        a {
            color: steelblue;
        }

        a:not(:hover) {
            text-decoration: none;
        }

        pre, code, textarea {
            font-family: "Menlo", monospace;
        }

        code {
            line-height: 1em;
        }

        textarea {
            font-size: 100%;
        }

        body > pre {
            border-left: solid 2px #ccc;
            padding-left: 18px;
            margin: 2em 0 2em -20px;
        }

        .html .value,
        .javascript .string,
        .javascript .regexp {
            color: #756bb1;
        }

        .html .tag,
        .css .tag,
        .javascript .keyword {
            color: #3182bd;
        }

        .comment {
            color: #636363;
        }

        .html .doctype,
        .javascript .number {
            color: #31a354;
        }

        .html .attribute,
        .css .attribute,
        .javascript .class,
        .javascript .special {
            color: #e6550d;
        }

        svg {
            font: 10px sans-serif;
        }

        .axis path, .axis line {
            fill: none;
            stroke: #000;
            shape-rendering: crispEdges;
        }

        sup, sub {
            line-height: 0;
        }

        q:before,
        blockquote:before {
            content: "“";
        }

        q:after,
        blockquote:after {
            content: "”";
        }

        blockquote:before {
            position: absolute;
            left: 2em;
        }

        blockquote:after {
            position: absolute;
        }
        #chart {
            height: 500px;
        }
        .node rect {
            cursor: move;
            fill-opacity: 1;
            shape-rendering: crispEdges;
        }
        .node rect:hover {
            fill-opacity: .2;
        }
        .node text {
            pointer-events: none;
            text-shadow: 0 1px 0 #fff;
        }
        .link {
            fill: none;
            stroke: #000;
            stroke-opacity: .2;
        }
        .link:hover {
            stroke-opacity: .5;
        }

    </style>
    <!--
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://d3js.org/d3.v3.min.js"></script>
    <script>
        var nodes = [
            [0,11,3],
            [1,10,3],
            [2,10,4],
            [3,9,2],
            [4,9,3],
            [5,9,4],
            [6,8,1],
            [7,8,2],
            [8,8,3],
            [9,7,0],
            [10,7,1],
            [11,7,2],
            [12,7,3]
        ]
        var edges = [
            [0,1,7],
            [0,2,3],
            [1,3,5],
            [1,4,2],
            [2,5,1],
            [3,6,1],
            [3,7,4],
            [4,8,2],
            [5,8,3],
            [6,9,1],
            [7,10,2],
            [7,11,2],
            [8,12,5]
        ]
        $(function(){
            var svgContainer = d3.select("body").append("svg")
                    .attr("width", 860)
                    .attr("height", 500)
                    .style("border", "1px solid black");

            var x_gap = 50, y_gap = 50, c_size = 10;
            var x_offset = 50, y_offset = 50;

            for(var i = 0; i < edges.length; i++)
            {
                node1 = nodes[edges[i][0]];
                node2 = nodes[edges[i][1]];
                x1 = node1[1] * x_gap + x_offset;
                y1 = node1[2] * y_gap + y_offset;
                x2 = node2[1] * x_gap + x_offset;
                y2 = node2[2] * y_gap + y_offset;

                var lineSelection = svgContainer.append("svg:line")
                        .attr("x1", x1)
                        .attr("y1", y1)
                        .attr("x2", x2)
                        .attr("y2", y2)
                        .style("stroke", "red")
                        .style("stroke-width", edges[i][2]);
            }

            for(var i = 0; i < nodes.length; i++)
            {
                x = nodes[i][1] * x_gap + x_offset;
                y = nodes[i][2] * y_gap + y_offset;

                var circleSelection = svgContainer.append("svg:circle")
                        .attr("cx", x)
                        .attr("cy", y)
                        .attr("r", c_size)
                        .style("fill", "black");
            }


        });
    </script>-->
</head>
<body>
    <p id="chart">

    <script>
    d3.sankey = function() {
        var sankey = {},
            nodeWidth = 24,
            nodePadding = 8,
            size = [1, 1],
            nodes = [],
            links = [];

        sankey.nodeWidth = function(_) {
            if (!arguments.length) return nodeWidth;
            nodeWidth = +_;
            return sankey;
        };

        sankey.nodePadding = function(_) {
            if (!arguments.length) return nodePadding;
            nodePadding = +_;
            return sankey;
        };

        sankey.nodes = function(_) {
            if (!arguments.length) return nodes;
            nodes = _;
            return sankey;
        };

        sankey.links = function(_) {
            if (!arguments.length) return links;
            links = _;
            return sankey;
        };

        sankey.size = function(_) {
            if (!arguments.length) return size;
            size = _;
            return sankey;
        };

        sankey.layout = function(iterations) {
            computeNodeLinks();
            computeNodeValues();
            computeNodeBreadths();
            computeNodeDepths(iterations);
            computeLinkDepths();
            return sankey;
        };

        sankey.relayout = function() {
            computeLinkDepths();
            return sankey;
        };

        sankey.link = function() {
            var curvature = .5;

            function link(d) {
                var x0 = d.source.x + d.source.dx,
                        x1 = d.target.x,
                        xi = d3.interpolateNumber(x0, x1),
                        x2 = xi(curvature),
                        x3 = xi(1 - curvature),
                        y0 = d.source.y + d.sy + d.dy / 2,
                        y1 = d.target.y + d.ty + d.dy / 2;
                return "M" + x0 + "," + y0
                        + "C" + x2 + "," + y0
                        + " " + x3 + "," + y1
                        + " " + x1 + "," + y1;
            }

            link.curvature = function(_) {
                if (!arguments.length) return curvature;
                curvature = +_;
                return link;
            };

            return link;
        };

        // Populate the sourceLinks and targetLinks for each node.
        // Also, if the source and target are not objects, assume they are indices.
        function computeNodeLinks() {
            nodes.forEach(function(node) {
                node.sourceLinks = [];
                node.targetLinks = [];
            });
            links.forEach(function(link) {
                var source = link.source,
                        target = link.target;
                if (typeof source === "number") source = link.source = nodes[link.source];
                if (typeof target === "number") target = link.target = nodes[link.target];
                source.sourceLinks.push(link);
                target.targetLinks.push(link);
            });
        }

        // Compute the value (size) of each node by summing the associated links.
        function computeNodeValues() {
            nodes.forEach(function(node) {
                node.value = Math.max(
                        d3.sum(node.sourceLinks, value),
                        d3.sum(node.targetLinks, value)
                );
            });
        }

        // Iteratively assign the breadth (x-position) for each node.
        // Nodes are assigned the maximum breadth of incoming neighbors plus one;
        // nodes with no incoming links are assigned breadth zero, while
        // nodes with no outgoing links are assigned the maximum breadth.
        function computeNodeBreadths() {
            var remainingNodes = nodes,
                    nextNodes,
                    x = 0;

            while (remainingNodes.length) {
                nextNodes = [];
                remainingNodes.forEach(function(node) {
                    node.x = x;
                    node.dx = nodeWidth;
                    node.sourceLinks.forEach(function(link) {
                        nextNodes.push(link.target);
                    });
                });
                remainingNodes = nextNodes;
                ++x;
            }

            //
            moveSinksRight(x);
            scaleNodeBreadths((width - nodeWidth) / (x - 1));
        }

        function moveSourcesRight() {
            nodes.forEach(function(node) {
                if (!node.targetLinks.length) {
                    node.x = d3.min(node.sourceLinks, function(d) { return d.target.x; }) - 1;
                }
            });
        }

        function moveSinksRight(x) {
            nodes.forEach(function(node) {
                if (!node.sourceLinks.length) {
                    node.x = x - 1;
                }
            });
        }

        function scaleNodeBreadths(kx) {
            nodes.forEach(function(node) {
                node.x *= kx;
            });
        }

        function computeNodeDepths(iterations) {
            var nodesByBreadth = d3.nest()
                    .key(function(d) { return d.x; })
                    .sortKeys(d3.ascending)
                    .entries(nodes)
                    .map(function(d) { return d.values; });

            //
            initializeNodeDepth();
            resolveCollisions();
            for (var alpha = 1; iterations > 0; --iterations) {
                relaxRightToLeft(alpha *= .99);
                resolveCollisions();
                relaxLeftToRight(alpha);
                resolveCollisions();
            }

            function initializeNodeDepth() {
                var ky = d3.min(nodesByBreadth, function(nodes) {
                    return (size[1] - (nodes.length - 1) * nodePadding) / d3.sum(nodes, value);
                });

                nodesByBreadth.forEach(function(nodes) {
                    nodes.forEach(function(node, i) {
                        node.y = i;
                        node.dy = node.value * ky;
                    });
                });

                links.forEach(function(link) {
                    link.dy = link.value * ky;
                });
            }

            function relaxLeftToRight(alpha) {
                nodesByBreadth.forEach(function(nodes, breadth) {
                    nodes.forEach(function(node) {
                        if (node.targetLinks.length) {
                            var y = d3.sum(node.targetLinks, weightedSource) / d3.sum(node.targetLinks, value);
                            node.y += (y - center(node)) * alpha;
                        }
                    });
                });

                function weightedSource(link) {
                    return center(link.source) * link.value;
                }
            }

            function relaxRightToLeft(alpha) {
                nodesByBreadth.slice().reverse().forEach(function(nodes) {
                    nodes.forEach(function(node) {
                        if (node.sourceLinks.length) {
                            var y = d3.sum(node.sourceLinks, weightedTarget) / d3.sum(node.sourceLinks, value);
                            node.y += (y - center(node)) * alpha;
                        }
                    });
                });

                function weightedTarget(link) {
                    return center(link.target) * link.value;
                }
            }

            function resolveCollisions() {
                nodesByBreadth.forEach(function(nodes) {
                    var node,
                            dy,
                            y0 = 0,
                            n = nodes.length,
                            i;

                    // Push any overlapping nodes down.
                    nodes.sort(ascendingDepth);
                    for (i = 0; i < n; ++i) {
                        node = nodes[i];
                        dy = y0 - node.y;
                        if (dy > 0) node.y += dy;
                        y0 = node.y + node.dy + nodePadding;
                    }

                    // If the bottommost node goes outside the bounds, push it back up.
                    dy = y0 - nodePadding - size[1];
                    if (dy > 0) {
                        y0 = node.y -= dy;

                        // Push any overlapping nodes back up.
                        for (i = n - 2; i >= 0; --i) {
                            node = nodes[i];
                            dy = node.y + node.dy + nodePadding - y0;
                            if (dy > 0) node.y -= dy;
                            y0 = node.y;
                        }
                    }
                });
            }

            function ascendingDepth(a, b) {
                return a.y - b.y;
            }
        }

        function computeLinkDepths() {
            nodes.forEach(function(node) {
                node.sourceLinks.sort(ascendingTargetDepth);
                node.targetLinks.sort(ascendingSourceDepth);
            });
            nodes.forEach(function(node) {
                var sy = 0, ty = 0;
                node.sourceLinks.forEach(function(link) {
                    link.sy = sy;
                    sy += link.dy;
                });
                node.targetLinks.forEach(function(link) {
                    link.ty = ty;
                    ty += link.dy;
                });
            });

            function ascendingSourceDepth(a, b) {
                return a.source.y - b.source.y;
            }

            function ascendingTargetDepth(a, b) {
                return a.target.y - b.target.y;
            }
        }

        function center(node) {
            return node.y + node.dy / 2;
        }

        function value(link) {
            return link.value;
        }

        return sankey;
    };
    </script>
    <script> var mcpherSankeyData = {"nodes": [{"name": "10:com.example.urqanative.MainActivity:onCreate:33"}, {"name": "9:com.example.urqanative.MainActivity:onCreate:32"}, {"name": "8:com.example.urqanative.MainActivity:onCreate:31"}, {"name": "7:com.example.urqanative.MainActivity:onCreate:30"}, {"name": "6:com.example.urqanative.MainActivity:onCreate:29"}, {"name": "5:com.example.urqanative.MainActivity:onCreate:28"}], "links": [{"source": 0, "target": 1, "value": 10}, {"source": 2, "target": 3, "value": 10}, {"source": 3, "target": 4, "value": 10}, {"source": 4, "target": 5, "value": 10}, {"source": 1, "target": 2, "value": 10}]};
//{'nodes': [{'name': u'10:com.example.urqanative.MainActivity:onCreate:33'}, {'name': u'9:com.example.urqanative.MainActivity:onCreate:32'}, {'name': u'8:com.example.urqanative.MainActivity:onCreate:31'}, {'name': u'7:com.example.urqanative.MainActivity:onCreate:30'}, {'name': u'6:com.example.urqanative.MainActivity:onCreate:29'}, {'name': u'5:com.example.urqanative.MainActivity:onCreate:28'}], 'links': [{'source': 0, 'target': 1, 'value': 10}, {'source': 2, 'target': 3, 'value': 10}, {'source': 3, 'target': 4, 'value': 10}, {'source': 4, 'target': 5, 'value': 10}, {'source': 1, 'target': 2, 'value': 10}]}


//    {'nodes': [{'name': '10:com.example.urqanative.MainActivity:onCreate:33'}, {'name': '9:com.example.urqanative.MainActivity:onCreate:32'}, {'name': '8:com.example.urqanative.MainActivity:onCreate:31'}, {'name': '7:com.example.urqanative.MainActivity:onCreate:30'}, {'name': '6:com.example.urqanative.MainActivity:onCreate:29'}, {'name': '5:com.example.urqanative.MainActivity:onCreate:28'}], 'links': [{'source': 0, 'target': 1, 'value': 10}, {'source': 2, 'target': 3, 'value': 10}, {'source': 3, 'target': 4, 'value': 10}, {'source': 4, 'target': 5, 'value': 10}, {'source': 1, 'target': 2, 'value': 10}]}
//    {'nodes': [{'name': '10:com.example.urqanative.MainActivity:onCreate:1'}, {'name': '10:com.example.urqanative.MainActivity:onCreate:2'}, {'name': '9:com.example.urqanative.MainActivity:onCreate:3'}, {'name': '9:com.example.urqanative.MainActivity:onCreate:5'}, {'name': '9:com.example.urqanative.MainActivity:onCreate:4'}, {'name': '8:com.example.urqanative.MainActivity:onCreate:8'}, {'name': '8:com.example.urqanative.MainActivity:onCreate:7'}, {'name': '8:com.example.urqanative.MainActivity:onCreate:6'}, {'name': '7:com.example.urqanative.MainActivity:onCreate:12'}, {'name': '7:com.example.urqanative.MainActivity:onCreate:11'}, {'name': '7:com.example.urqanative.MainActivity:onCreate:10'}, {'name': '7:com.example.urqanative.MainActivity:onCreate:9'}, {'name': '6:com.example.urqanative.MainActivity:onCreate:14'}, {'name': '6:com.example.urqanative.MainActivity:onCreate:15'}, {'name': '6:com.example.urqanative.MainActivity:onCreate:13'}, {'name': '5:com.example.urqanative.MainActivity:onCreate:16'}, {'name': '5:com.example.urqanative.MainActivity:onCreate:17'}, {'name': '5:com.example.urqanative.MainActivity:onCreate:19'}, {'name': '5:com.example.urqanative.MainActivity:onCreate:18'}], 'links': [{'source': 14, 'target': 15, 'value': 2}, {'source': 12, 'target': 15, 'value': 4}, {'source': 7, 'target': 11, 'value': 1}, {'source': 11, 'target': 14, 'value': 1}, {'source': 9, 'target': 12, 'value': 2}, {'source': 8, 'target': 14, 'value': 1}, {'source': 8, 'target': 13, 'value': 4}, {'source': 13, 'target': 15, 'value': 1}, {'source': 13, 'target': 16, 'value': 1}, {'source': 13, 'target': 17, 'value': 1}, {'source': 1, 'target': 3, 'value': 3}, {'source': 0, 'target': 2, 'value': 5}, {'source': 13, 'target': 18, 'value': 1}, {'source': 0, 'target': 4, 'value': 2}, {'source': 3, 'target': 5, 'value': 3}, {'source': 2, 'target': 7, 'value': 1}, {'source': 2, 'target': 6, 'value': 4}, {'source': 4, 'target': 5, 'value': 2}, {'source': 5, 'target': 8, 'value': 5}, {'source': 6, 'target': 10, 'value': 2}, {'source': 10, 'target': 12, 'value': 2}, {'source': 6, 'target': 9, 'value': 2}]}
//            {"nodes":[{"name":"Finance"},{"name":"Sales"},{"name":"Account management"},{"name":"Accounts Payable"},{"name":"Accounts Receivable"},{"name":"Lead Generation"},{"name":"Order management"},{"name":"Pricing"},{"name":"Reporting"},{"name":"Tax"},{"name":"Treasury"},{"name":"Admin"},{"name":"Management"},{"name":"Operations"} ],
//             "links":[{"source":0,"target":4,"value":15},{"source":0,"target":3,"value":12},{"source":0,"target":10,"value":4},{"source":0,"target":9,"value":8},{"source":0,"target":8,"value":12},{"source":4,"target":11,"value":4},{"source":3,"target":11,"value":2},{"source":10,"target":11,"value":1},{"source":9,"target":11,"value":3},{"source":8,"target":11,"value":2},{"source":4,"target":12,"value":2},{"source":3,"target":12,"value":3},{"source":10,"target":12,"value":1},{"source":9,"target":12,"value":1},{"source":8,"target":12,"value":3},{"source":4,"target":13,"value":9},{"source":3,"target":13,"value":7},{"source":10,"target":13,"value":2},{"source":9,"target":13,"value":4},{"source":8,"target":13,"value":7},{"source":1,"target":5,"value":20},{"source":1,"target":2,"value":16},{"source":1,"target":7,"value":10},{"source":1,"target":6,"value":10},{"source":1,"target":8,"value":12},{"source":5,"target":11,"value":4},{"source":2,"target":11,"value":2},{"source":7,"target":11,"value":1},{"source":6,"target":11,"value":3},{"source":8,"target":11,"value":2},{"source":5,"target":12,"value":3},{"source":2,"target":12,"value":4},{"source":7,"target":12,"value":2},{"source":6,"target":12,"value":2},{"source":8,"target":12,"value":4},{"source":5,"target":13,"value":13},{"source":2,"target":13,"value":10},{"source":7,"target":13,"value":7},{"source":6,"target":13,"value":5},{"source":8,"target":13,"value":6} ]}
/*            {"nodes":[{"name":"classjava.java:123"},{"name":"1"},{"name":"2"},{"name":"3"},{"name":"4"},{"name":"5"},{"name":"6"},{"name":"7"},{"name":"8"},{"name":"9"},{"name":"10"},{"name":"11"},{"name":"12"},{"name":"13"},{"name":"14"},{"name":"15"},{"name":"16"},{"name":"17"},{"name":"18"},{"name":"19"}],
             "links":[
                 {"source":0,"target":1,"value":7},
                 {"source":0,"target":2,"value":3},
                 {"source":1,"target":3,"value":5},
                 {"source":1,"target":4,"value":2},
                 {"source":2,"target":5,"value":3},
                 {"source":3,"target":6,"value":1},
                 {"source":3,"target":7,"value":4},
                 {"source":4,"target":8,"value":2},
                 {"source":5,"target":8,"value":3},
                 {"source":6,"target":9,"value":1},
                 {"source":7,"target":10,"value":2},
                 {"source":7,"target":11,"value":2},
                 {"source":8,"target":12,"value":5},
                 {"source":9,"target":13,"value":1},
                 {"source":10,"target":14,"value":2},
                 {"source":11,"target":14,"value":2},
                 {"source":12,"target":13,"value":1},
                 {"source":12,"target":15,"value":4},
                 {"source":13,"target":16,"value":2},
                 {"source":14,"target":16,"value":4},
                 {"source":15,"target":16,"value":1},
                 {"source":15,"target":17,"value":1},
                 {"source":15,"target":18,"value":1},
                 {"source":15,"target":19,"value":1}
             ]
            };*/

    </script>
    <script>
        var margin = {
                    top : 1,
                    right : 1,
                    bottom : 6,
                    left : 1
                },
                width = 760 - margin.left - margin.right,
                height = 300 - margin.top - margin.bottom;
        var formatNumber = d3.format(",.0f"), format = function(d) {
                    return formatNumber(d) ;
                },
                color = d3.scale.category20();

        var svg = d3.select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");

        var sankey = d3.sankey()
                .nodeWidth(20)
                .nodePadding(10)
                .size([width, height]);

        var path = sankey.link();

        sankey.nodes(mcpherSankeyData.nodes)
                .links(mcpherSankeyData.links)
                .layout(32);

        link_tip = d3.tip()
                .html(function(d) {
                    return d.source.name + " -> " + d.target.name + format(d.value);
                })
                .direction('s')
                .attr('class', 'd3-tip')
                //.offset([-12, 0])
        var link = svg.append("g")
                .selectAll(".link")
                .data(mcpherSankeyData.links)
                .enter()
                .append("path")
                .attr("class", "link")
                .attr("d", path)
                .style("stroke-width",
                    function(d) {
                        return Math.max(1, d.dy);
                    })
                .sort(function(a, b) {
                    return b.dy - a.dy;
                })
                .call(link_tip);
        link.on('mouseover', link_tip.show)
            .on('mouseout', link_tip.hide)
            /*.attr('y', function(d) {
                    return y(d)
                })
            .attr('x', function(d, i) {
                    return x(i)
                })
        /*link.append("title")
                .text(function(d) {
                    return d.source.name + " ->\n" + d.target.name + "\n" + format(d.value);
                });*/

        rect_tip = d3.tip()
                .html(function(d) {
                    return d.name + format(d.value);
                })
                .attr('class', 'd3-tip')
                .direction('s')
                //.offset([-12, 0])
        var node = svg.append("g")
                .selectAll(".node")
                .data(mcpherSankeyData.nodes)
                .enter()
                .append("g")
                .attr("class", "node")
                .attr("transform",
                    function(d) {
                        return "translate(" + d.x + "," + d.y + ")";
                    })
                .call(d3.behavior.drag()
                        .origin(function(d) {
                                return d;
                            }
                        )
                        .on("dragstart", function() {
                                this.parentNode.appendChild(this);
                            }
                        )
                        .on("drag", dragmove))
                .call(rect_tip);

        node.append("rect")
                .attr("height",
                function(d) {
                    return d.dy;
                })
                .attr("width", sankey.nodeWidth())
                .style("fill", function(d) {
                    return d.color = color(d.name.replace(/ .*/, ""));
                })
                .style("stroke", function(d) {
                    return d3.rgb(d.color).darker(2);
                })
                .on('mouseover', rect_tip.show)
                .on('mouseout', rect_tip.hide)
                ;/*
                .append("title")
                .text(function(d) {
                    return d.name + "\n" + format(d.value);
                });*/

        node.append("text")
                .attr("x", -6)
                .attr("y", function(d) {
                    return d.dy / 2;
                }
        )
                .attr("dy", ".35em")
                .attr("text-anchor", "end")
                .attr("transform", null)
                .text(function(d) {
                    return d.name;
                }
        )
                .filter(function(d) {
                    return d.x < width / 2;
                }
        )
                .attr("x", 6 + sankey.nodeWidth())
                .attr("text-anchor", "start");

        function dragmove(d) {
            d3.select(this)
                    .attr("transform", "translate(" + d.x + "," + (d.y = Math.max(0, Math.min(height - d.dy, d3.event.y))) + ")");
            sankey.relayout();
            link.attr("d", path);
        }

    </script>
</body>
</html>